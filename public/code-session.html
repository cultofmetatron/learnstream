<!doctype html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" ><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]-->

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <title>Learnstream</title>
    <link id="favicon" rel="icon" type="image/png" href="/assets/images/favicon.png" />
    <link rel="stylesheet" href="/assets/stylesheets/fontfaces.css" />
    <link rel="stylesheet" href="/assets/stylesheets/normalize.css" />
    <link rel="stylesheet" href="/assets/stylesheets/foundation.css" />
    <link rel="stylesheet" href="/assets/stylesheets/bg.css" />
    <link rel="stylesheet" href="/assets/stylesheets/style.css" />
    <script src="/assets/javascripts/vendor/custom.modernizr.js"></script>

    <script src="http://ajaxorg.github.com/ace/build/src/ace.js"></script>
    <script src="/bcsocket.js"></script>
    <script src="/share.js"></script>
    <script src="/ace.js"></script>
    <script src="http://static.opentok.com/webrtc/v2.0/js/TB.min.js" ></script>
  </head>

  <body>

    <div class="topBar">
      <div class="header row">
        <h3 class="large-6 columns"><img src="/assets/images/icon.png" />Learnstream</h3>
      </div>
    </div>

    <div class="codeSession row">
      <div id="editor" class="small-8 large-8 columns"></div>
      <div id="chat" class="small-4 large-4 columns">
        <div id="myPublisherDiv"></div>
        <script type="text/javascript">
          var apiKey = "27519952";
          var sessionId = "2_MX4yNzUxOTk1Mn4xMjcuMC4wLjF-TW9uIEFwciAyOSAxNjozMTo0NiBQRFQgMjAxM34wLjk4ODMyNDQ2fg";
          var token = "T1==cGFydG5lcl9pZD0yNzUxOTk1MiZzZGtfdmVyc2lvbj10YnJ1YnktdGJyYi12MC45MS4yMDExLTAyLTE3JnNpZz04NGNmYzZhZWY2MzY1Zjg4ZWZmNGM5ZjljYTQ2NGFlZjVhZmQzZTU5OnJvbGU9cHVibGlzaGVyJnNlc3Npb25faWQ9Ml9NWDR5TnpVeE9UazFNbjR4TWpjdU1DNHdMakYtVFc5dUlFRndjaUF5T1NBeE5qb3pNVG8wTmlCUVJGUWdNakF4TTM0d0xqazRPRE15TkRRMmZnJmNyZWF0ZV90aW1lPTEzNjcyNzg0Mjcmbm9uY2U9MC45MjUwMzQ2Mzc1NTQ5NjIyJmV4cGlyZV90aW1lPTEzNjk4NzA0MjcmY29ubmVjdGlvbl9kYXRhPQ==";

          var session = TB.initSession(sessionId);
          session.addEventListener('sessionConnected', sessionConnectedHandler);
          session.connect(apiKey, token);
          
          function sessionConnectedHandler(event) {
            var publisher = TB.initPublisher(apiKey, 'myPublisherDiv');
            session.publish(publisher);
          }
        </script>
      </div>
    </div>

    <script>
    document.write('<script src=' +
    ('__proto__' in {} ? '/assets/javascripts/vendor/zepto' : '/assets/javascripts/vendor/jquery') +
    '.js><\/script>')
    </script>

    <script src="/assets/javascripts/foundation.min.js"></script>

    <!--
    <script src="/assets/javascripts/foundation/foundation.js"></script>
    <script src="/assets/javascripts/foundation/foundation.alerts.js"></script>
    <script src="/assets/javascripts/foundation/foundation.clearing.js"></script>
    <script src="/assets/javascripts/foundation/foundation.cookie.js"></script>
    <script src="/assets/javascripts/foundation/foundation.dropdown.js"></script>
    <script src="/assets/javascripts/foundation/foundation.forms.js"></script>
    <script src="/assets/javascripts/foundation/foundation.joyride.js"></script>
    <script src="/assets/javascripts/foundation/foundation.magellan.js"></script>
    <script src="/assets/javascripts/foundation/foundation.orbit.js"></script>
    <script src="/assets/javascripts/foundation/foundation.placeholder.js"></script>
    <script src="/assets/javascripts/foundation/foundation.reveal.js"></script>
    <script src="/assets/javascripts/foundation/foundation.section.js"></script>
    <script src="/assets/javascripts/foundation/foundation.tooltips.js"></script>
    <script src="/assets/javascripts/foundation/foundation.topbar.js"></script>
    -->
    <script>$(document).foundation();</script>

    <script>
      var editor = ace.edit('editor');
      editor.session.setUseWrapMode(true);
      editor.setTheme('ace/theme/tomorrow_night');
      editor.getSession().setMode('ace/mode/javascript');
      editor.getSession().setTabSize(2);

      sharejs.open('hello', 'text', function(error, doc) {
        doc.attach_ace(editor);
      });

      // Set bindings for indenting/outdenting blocks of code
      // editor.commands.addCommand({
      //   name: 'indent',
      //   bindKey: {win: 'Ctrl-[',  mac: 'Command-['},
      //   exec: function(editor) {
      //     editor.tabSize(-2);
      //   },
      //   readOnly: false
      // });

      // Grabs value of a query string parameter.
      // i.e., http://animal.com/?cow=moo
      // getParameterByName(cow) // moo
      function getParameterByName(name) {
        name = name.replace(/[\[]/, '\\\[').replace(/[\]]/, '\\\]');
        var regexS = '[\\?&]' + name + '=([^&#]*)';
        var regex = new RegExp(regexS);
        var results = regex.exec(window.location.search);
        if(results == null) {
          return '';
        } else {
          return decodeURIComponent(results[1].replace(/\+/g, ' '));
        }
      }
    </script>
  </body>
</html>
