<!doctype html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" ><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Learnstream</title>
    <link id="favicon" rel="icon" type="image/png" href="/assets/images/favicon.png" />
    <link rel="stylesheet" href="/assets/stylesheets/fontfaces.css" />
    <link rel="stylesheet" href="/assets/stylesheets/normalize.css" />
    <link rel="stylesheet" href="/assets/stylesheets/foundation.css" />
    <link rel="stylesheet" href="/assets/stylesheets/bg.css" />
    <link rel="stylesheet" href="/assets/stylesheets/style.css" />

    <script type="text/javascript" src="/assets/javascripts/vendor/jquery.js"></script>
    <script src="/assets/javascripts/vendor/custom.modernizr.js"></script>
    <script src="/assets/javascripts/vendor/handlebars.js"></script>
    <script src='https://cdn.firebase.com/v0/firebase.js'></script>
    <script src="/assets/javascripts/vendor/underscore.js"></script>
    <script src="/assets/javascripts/vendor/backbone.js"></script>
    <script src="/assets/javascripts/vendor/backbone-firebase.js"></script>
    <script src="/assets/javascripts/questionstream.js"></script>
    <script src="/assets/javascripts/singlyauth.js"></script>
  </head>
  <script>
    var accessToken = '<%= session.accessToken %>';
    var firebaseUrl = '<%= session.fireBase %>';
    var githubReqUrl =  'https://api.singly.com/services/github/self?access_token=' + accessToken;
    $(function() {
      $.ajax({
        url: githubReqUrl,
        success: function(data) {
          var userName = data['0']['data']['name'];
          var image = data['0']['data']['avatar_url'];
          $('.userInfo').text(userName).append("<img src=" + image + " width='42' height='42' class='avatar' />");
        }
      });

      var questions = new Questions();
      var questionsView = new QuestionsView({collection: questions});
      questionsView.render();

      var reloadTasks = function() {
        questions.fetch();
        questionsView.render();
        questionsView.el;
        $('#question-item').append(questionsView.el);
      }
      setInterval(reloadTasks, 5000);
    });
  </script>

  <body>
    <div class="topBar">
      <div class="header row">
        <h3 class="small-6 large-6 columns"><img src="/assets/images/icon.png" />Learnstream</h3>
        <a href="#" class="login small-6 large-6 columns"><span class="userInfo"></span></a>
      </div>
    </div>

    <div class="content row">
      <div id="question-item">
      </div>
    </div>

    <script id="question-item" type="template">
      <div class="helpRequest">
        <p>{{desc}}</p>
        <a href="/question/{{id}}">help this guy out?</a>
      </div>
    </script>

    <script src="/assets/javascripts/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
  </body>
</html>

